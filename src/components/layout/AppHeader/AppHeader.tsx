import './AppHeader.css'
import '../../../assets/styles/flex-patterns.css'
import { useEffect, useRef, useState } from "react";
import { useWindowSize } from "../../../states/windowSizeState.ts";
import { AppNavbar } from "../AppNavbar/AppNavbar.tsx";

export const AppHeader = () => {
    const [isDropDownMenuVisible, setIsDropDownMenuVisible] = useState(false);
    const sideBarRef = useRef<HTMLElement | null>(null);

    useEffect(() => {
        const handleClickOutside = (event: MouseEvent) => {
            const targetElement = event.target as Element;

            if (
                sideBarRef.current &&
                !sideBarRef.current.contains(event.target as Node) &&
                !targetElement.classList.contains('sidebar') &&
                !targetElement.classList.contains('sidebar-toggle')
            ) {
                setIsDropDownMenuVisible(false);
            }
        }

        document.addEventListener('click', handleClickOutside);
        return () => {
            document.removeEventListener('click', handleClickOutside);
        }
    });

    return (
        <header className="header center-flex">
            <div className="header__container space-between-row-center-flex">
                <div
                    className={isDropDownMenuVisible && !useWindowSize.getState().isMobileScreen ?
                        "header__drop-down-menu-container center-column-top-flex menu-is-hovered gray-background" :
                        "header__drop-down-menu-container center-column-top-flex black-background"
                    }
                    onMouseOver={() => {
                        if (!useWindowSize.getState().isDesktopScreen && !useWindowSize.getState().isMobileScreen) {
                            setIsDropDownMenuVisible(true)
                        }
                    }}
                    onMouseOut={() => {
                        if (!useWindowSize.getState().isDesktopScreen && !useWindowSize.getState().isMobileScreen) {
                            setIsDropDownMenuVisible(false)
                        }
                    }}
                >
                    <div className="header__logo-container space-between-row-center-flex">
                        <div
                            className="header__menu-icon"
                            onClick={() => {
                                if (useWindowSize.getState().isMobileScreen) {
                                    setIsDropDownMenuVisible(true)
                                }
                            }}
                        >
                            <svg className="sidebar-toggle" width="28px" height="28px" viewBox="0 0 24 24" fill="none"
                                 xmlns="http://www.w3.org/2000/svg">
                                <g id="SVGRepo_bgCarrier" strokeWidth="0"></g>
                                <g id="SVGRepo_tracerCarrier" strokeLinecap="round" strokeLinejoin="round"></g>
                                <g id="SVGRepo_iconCarrier">
                                    <path fillRule="evenodd" clipRule="evenodd" d="M19.5 8.25H4.5V6.75H19.5V8.25Z"
                                          fill="currentColor"></path>
                                    <path fillRule="evenodd" clipRule="evenodd" d="M19.5 12.75H4.5V11.25H19.5V12.75Z"
                                          fill="currentColor"></path>
                                    <path fillRule="evenodd" clipRule="evenodd" d="M19.5 17.25H4.5V15.75H19.5V17.25Z"
                                          fill="currentColor"></path>
                                </g>
                            </svg>
                        </div>
                        <div className="header__logo">
                            <svg xmlns="http://www.w3.org/2000/svg" width="96" height="24" viewBox="0 0 96 24"
                                 fill="none">
                                <path
                                    d="M0.302 23V0.6H5.475L6.756 11.982L7.624 20.543H7.967L8.842 11.989L10.088 0.6H15.296V23H14.694V1.09H10.606L9.36 12.367L8.443 21.033H7.162L6.245 12.367L4.957 1.09H0.904V23H0.302ZM2.78 23L2.668 13.97L2.227 2.567H3.508L4.803 13.942L5.713 22.51H9.878L10.795 13.935L12.083 2.567H13.371L12.937 13.97L12.825 23H12.216L12.328 14.446L12.839 3.057H12.538L11.32 14.425L10.424 23H5.174L4.285 14.425L3.067 3.057H2.759L3.27 14.446L3.382 23H2.78ZM1.513 23L1.457 12.899L1.261 1.58H4.467L5.776 12.738L6.658 21.523H8.905L9.822 12.738L11.145 1.58H14.337L14.148 12.899L14.092 23H13.483L13.539 13.515L13.77 2.077H11.656L10.326 13.375L9.395 22.02H6.168L5.272 13.375L3.963 2.077H1.835L2.059 13.515L2.115 23H1.513ZM22.5594 23.238C20.856 23.238 19.638 22.8763 18.9054 22.153C18.1774 21.425 17.7947 20.2443 17.7574 18.611C17.7294 17.2763 17.7084 16.0467 17.6944 14.922C17.685 13.7927 17.6804 12.7053 17.6804 11.66C17.685 10.61 17.692 9.546 17.7014 8.468C17.7154 7.38533 17.734 6.22333 17.7574 4.982C17.7947 3.344 18.1797 2.16567 18.9124 1.447C19.645 0.723665 20.8607 0.361999 22.5594 0.361999C24.2347 0.361999 25.4364 0.723665 26.1644 1.447C26.897 2.17033 27.2867 3.34867 27.3334 4.982C27.366 6.25133 27.3894 7.453 27.4034 8.587C27.422 9.721 27.4314 10.827 27.4314 11.905C27.4314 12.9783 27.422 14.0633 27.4034 15.16C27.3894 16.2567 27.366 17.407 27.3334 18.611C27.282 20.235 26.8947 21.4133 26.1714 22.146C25.448 22.874 24.244 23.238 22.5594 23.238ZM22.5594 22.741C24.034 22.741 25.0864 22.4143 25.7164 21.761C26.351 21.1077 26.6894 20.0507 26.7314 18.59C26.7594 17.3907 26.7804 16.2473 26.7944 15.16C26.813 14.068 26.8224 12.9877 26.8224 11.919C26.8224 10.8503 26.8154 9.75133 26.8014 8.622C26.7874 7.488 26.764 6.28167 26.7314 5.003C26.6894 3.533 26.351 2.476 25.7164 1.832C25.0817 1.18333 24.0294 0.858999 22.5594 0.858999C21.0474 0.858999 19.9787 1.18567 19.3534 1.839C18.728 2.49233 18.399 3.54467 18.3664 4.996C18.3384 6.326 18.3174 7.55567 18.3034 8.685C18.2894 9.81433 18.2824 10.904 18.2824 11.954C18.287 12.9993 18.294 14.061 18.3034 15.139C18.3174 16.217 18.3384 17.3697 18.3664 18.597C18.399 20.0483 18.728 21.103 19.3534 21.761C19.9787 22.4143 21.0474 22.741 22.5594 22.741ZM22.5594 22.251C21.276 22.251 20.3637 21.9663 19.8224 21.397C19.2857 20.823 19.001 19.885 18.9684 18.583C18.9404 17.253 18.9194 16.0233 18.9054 14.894C18.896 13.7647 18.8914 12.6773 18.8914 11.632C18.8914 10.5867 18.8984 9.52733 18.9124 8.454C18.9264 7.38067 18.945 6.23267 18.9684 5.01C18.9964 3.70333 19.281 2.76767 19.8224 2.203C20.3684 1.63367 21.2807 1.349 22.5594 1.349C23.8334 1.349 24.7364 1.64067 25.2684 2.224C25.8004 2.80267 26.085 3.73367 26.1224 5.017C26.1597 6.361 26.1854 7.59767 26.1994 8.727C26.2134 9.85633 26.2204 10.9413 26.2204 11.982C26.2204 13.0227 26.211 14.0773 26.1924 15.146C26.1784 16.21 26.155 17.351 26.1224 18.569C26.085 19.843 25.8027 20.7763 25.2754 21.369C24.7527 21.957 23.8474 22.251 22.5594 22.251ZM22.5594 21.761C23.6234 21.761 24.3747 21.5067 24.8134 20.998C25.252 20.4893 25.4877 19.675 25.5204 18.555C25.553 17.2483 25.5764 16.0467 25.5904 14.95C25.609 13.8533 25.6184 12.7893 25.6184 11.758C25.6184 10.7267 25.609 9.66967 25.5904 8.587C25.5764 7.50433 25.553 6.32367 25.5204 5.045C25.4877 3.94833 25.259 3.141 24.8344 2.623C24.4144 2.10033 23.656 1.839 22.5594 1.839C21.4767 1.839 20.7137 2.091 20.2704 2.595C19.8317 3.09433 19.6007 3.90167 19.5774 5.017C19.5494 6.305 19.5284 7.50433 19.5144 8.615C19.5004 9.72567 19.4934 10.806 19.4934 11.856C19.498 12.906 19.505 13.977 19.5144 15.069C19.5284 16.1563 19.5494 17.323 19.5774 18.569C19.6007 19.717 19.8387 20.536 20.2914 21.026C20.7487 21.516 21.5047 21.761 22.5594 21.761ZM22.5594 21.271C21.6914 21.271 21.0824 21.0587 20.7324 20.634C20.3824 20.2047 20.198 19.514 20.1794 18.562C20.1467 16.784 20.1234 15.1787 20.1094 13.746C20.1 12.3133 20.1024 10.9087 20.1164 9.532C20.1304 8.15067 20.1514 6.65033 20.1794 5.031C20.198 4.07433 20.3824 3.386 20.7324 2.966C21.0824 2.54133 21.6914 2.329 22.5594 2.329C23.4367 2.329 24.0434 2.553 24.3794 3.001C24.7154 3.44433 24.8927 4.13033 24.9114 5.059C24.944 6.39367 24.9674 7.61167 24.9814 8.713C25 9.80967 25.0094 10.8667 25.0094 11.884C25.0094 12.9013 25 13.9467 24.9814 15.02C24.9674 16.0887 24.944 17.26 24.9114 18.534C24.888 19.4767 24.706 20.1697 24.3654 20.613C24.0247 21.0517 23.4227 21.271 22.5594 21.271ZM22.5594 20.781C23.2127 20.781 23.6607 20.5967 23.9034 20.228C24.1507 19.8593 24.286 19.29 24.3094 18.52C24.342 17.2087 24.3654 16.0117 24.3794 14.929C24.398 13.8417 24.4074 12.7917 24.4074 11.779C24.4074 10.7617 24.398 9.71633 24.3794 8.643C24.3654 7.565 24.342 6.37733 24.3094 5.08C24.286 4.268 24.146 3.68933 23.8894 3.344C23.6374 2.994 23.194 2.819 22.5594 2.819C21.9247 2.819 21.4744 2.987 21.2084 3.323C20.9424 3.659 20.8024 4.233 20.7884 5.045C20.7557 6.76233 20.7324 8.33033 20.7184 9.749C20.7044 11.1677 20.7044 12.5747 20.7184 13.97C20.7324 15.3653 20.7557 16.8913 20.7884 18.548C20.8024 19.3273 20.9354 19.8943 21.1874 20.249C21.444 20.6037 21.9014 20.781 22.5594 20.781ZM31.4951 23L28.5691 0.6H29.1711L32.0271 22.51H36.0171L38.8661 0.6H39.4681L36.5421 23H31.4951ZM32.4191 22.02L31.4111 12.738L29.7871 0.6H30.4101L31.9921 12.444L32.9581 21.523H35.0791L36.0451 12.444L37.6271 0.6H38.2501L36.6191 12.738L35.6181 22.02H32.4191ZM33.3711 21.033L32.5171 12.234L31.0681 0.6H31.6701L33.0491 12.017L33.8401 20.543H34.1971L34.9811 12.017L36.3601 0.6H36.9621L35.5201 12.234L34.6661 21.033H33.3711ZM43.6303 23V0.6H44.2323V23H43.6303ZM41.2083 23V0.6H41.8103V23H41.2083ZM42.4193 23V0.6H43.0213V23H42.4193ZM46.8411 23V0.6H54.8421V1.132H47.4431V22.468H54.8421V23H46.8411ZM49.2631 20.886V12.458H54.5621V12.99H49.8651V20.354H54.8421V20.886H49.2631ZM48.0521 21.943V1.657H54.8421V2.189H48.6541V11.401H54.5621V11.933H48.6541V21.411H54.8421V21.943H48.0521ZM49.2631 10.876V2.714H54.8421V3.246H49.8651V10.344H54.5621V10.876H49.2631ZM56.7668 23V0.6H64.7678V1.132H57.3688V23H56.7668ZM59.1888 23V12.458H64.4878V12.99H59.7908V23H59.1888ZM57.9778 23V1.657H64.7678V2.189H58.5798V11.401H64.4878V11.933H58.5798V23H57.9778ZM59.1888 10.876V2.714H64.7678V3.246H59.7908V10.344H64.4878V10.876H59.1888ZM68.9779 23V0.6H69.5799V23H68.9779ZM66.5559 23V0.6H67.1579V23H66.5559ZM67.7669 23V0.6H68.3689V23H67.7669ZM72.1887 23V0.6H77.4177L78.6357 9.686L80.0987 20.543H80.4487L79.8887 9.644L79.7697 0.6H80.3717L80.4977 9.644L81.0157 21.033H79.6297L76.8927 1.09H72.7907V23H72.1887ZM73.3997 23V13.396L73.1477 1.58H76.4097L79.2167 21.523H81.3797L81.0437 9.644L81.0367 0.6H81.6597L81.6667 9.644L81.8487 22.02H78.7267L75.8567 2.077H73.6797L74.0017 13.396V23H73.3997ZM74.6667 23L74.5547 13.396L74.0787 2.567H75.4157L78.2157 22.524H82.2057L82.2687 0.6H82.8707L82.8147 23H77.6277L76.3257 13.368L74.9607 3.057H74.6667L75.1567 13.396L75.2687 23H74.6667ZM85.4778 23V0.6H90.1048C91.1408 0.6 92.0134 0.74 92.7228 1.02C93.4368 1.3 93.9804 1.783 94.3538 2.469C94.7318 3.155 94.9324 4.10933 94.9558 5.332C94.9838 6.75067 95.0024 8.14367 95.0118 9.511C95.0211 10.8783 95.0211 12.276 95.0118 13.704C95.0071 15.132 94.9884 16.6487 94.9558 18.254C94.9324 19.4767 94.7318 20.4333 94.3538 21.124C93.9758 21.8147 93.4298 22.3 92.7158 22.58C92.0018 22.86 91.1291 23 90.0978 23H85.4778ZM86.0798 22.468H90.0978C90.7651 22.468 91.3601 22.4027 91.8828 22.272C92.4054 22.1367 92.8464 21.9103 93.2058 21.593C93.5698 21.2757 93.8474 20.844 94.0388 20.298C94.2348 19.752 94.3398 19.066 94.3538 18.24C94.3818 16.756 94.4004 15.3187 94.4098 13.928C94.4191 12.5327 94.4191 11.1327 94.4098 9.728C94.4004 8.31867 94.3818 6.85567 94.3538 5.339C94.3304 4.22833 94.1484 3.36967 93.8078 2.763C93.4718 2.15167 92.9888 1.727 92.3588 1.489C91.7334 1.251 90.9821 1.132 90.1048 1.132H86.0798V22.468ZM86.6888 21.943V1.657H90.1048C90.8701 1.657 91.5188 1.762 92.0508 1.972C92.5874 2.182 93.0004 2.55533 93.2898 3.092C93.5791 3.62867 93.7331 4.38233 93.7518 5.353C93.7751 6.46367 93.7914 7.54867 93.8008 8.608C93.8101 9.66267 93.8148 10.7127 93.8148 11.758C93.8148 12.8033 93.8101 13.8603 93.8008 14.929C93.7914 15.993 93.7751 17.092 93.7518 18.226C93.7331 19.192 93.5791 19.9457 93.2898 20.487C93.0051 21.0237 92.5944 21.4017 92.0578 21.621C91.5258 21.8357 90.8724 21.943 90.0978 21.943H86.6888ZM87.2908 21.411H90.0978C91.0918 21.411 91.8454 21.187 92.3588 20.739C92.8721 20.291 93.1334 19.4627 93.1428 18.254C93.1568 16.7373 93.1661 15.2883 93.1708 13.907C93.1754 12.521 93.1754 11.1303 93.1708 9.735C93.1661 8.33967 93.1568 6.872 93.1428 5.332C93.1334 4.14667 92.8791 3.32767 92.3798 2.875C91.8804 2.41767 91.1221 2.189 90.1048 2.189H87.2908V21.411ZM87.8998 20.886V2.714H90.1048C90.6181 2.714 91.0544 2.791 91.4138 2.945C91.7778 3.09433 92.0554 3.358 92.2468 3.736C92.4381 4.114 92.5361 4.646 92.5408 5.332C92.5548 6.82533 92.5641 8.26733 92.5688 9.658C92.5734 11.044 92.5734 12.4393 92.5688 13.844C92.5641 15.244 92.5548 16.714 92.5408 18.254C92.5314 19.2527 92.3238 19.941 91.9178 20.319C91.5164 20.697 90.9098 20.886 90.0978 20.886H87.8998ZM88.5018 20.354H90.0978C90.5038 20.354 90.8398 20.291 91.1058 20.165C91.3764 20.0343 91.5794 19.8173 91.7148 19.514C91.8548 19.206 91.9271 18.786 91.9318 18.254C91.9458 16.8633 91.9551 15.489 91.9598 14.131C91.9644 12.7683 91.9644 11.3683 91.9598 9.931C91.9598 8.489 91.9504 6.956 91.9318 5.332C91.9271 4.548 91.7754 4.00433 91.4768 3.701C91.1781 3.39767 90.7208 3.246 90.1048 3.246H88.5018V20.354Z"
                                    fill="white"/>
                            </svg>
                        </div>
                    </div>

                    {isDropDownMenuVisible && !useWindowSize.getState().isMobileScreen &&
                        <div
                            className="header__pop-up-menu-container"
                            onMouseOver={() => {
                                if (!useWindowSize.getState().isMobileScreen) {
                                    setIsDropDownMenuVisible(true)
                                }
                            }}
                            onMouseOut={() => {
                                if (!useWindowSize.getState().isMobileScreen) {
                                    setIsDropDownMenuVisible(false)
                                }
                            }}
                        >
                            <AppNavbar/>
                        </div>
                    }

                    {useWindowSize.getState().isMobileScreen &&
                        <aside
                            ref={sideBarRef}
                            className={`sidebar ${isDropDownMenuVisible ? 'visible' : ''}`}
                        >
                            <div className="header__slide-out-menu__header center-flex-end">
                                <div
                                    className="header__cross-icon"
                                    onClick={() => {
                                        if (useWindowSize.getState().isMobileScreen) {
                                            setIsDropDownMenuVisible(false)
                                        }
                                    }}
                                >
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                         className="ipc-icon ipc-icon--clear" viewBox="0 0 24 24"
                                         fill="currentColor"
                                         role="presentation">
                                        <path fill="none" d="M0 0h24v24H0V0z"></path>
                                        <path
                                            d="M18.3 5.71a.996.996 0 0 0-1.41 0L12 10.59 7.11 5.7A.996.996 0 1 0 5.7 7.11L10.59 12 5.7 16.89a.996.996 0 1 0 1.41 1.41L12 13.41l4.89 4.89a.996.996 0 1 0 1.41-1.41L13.41 12l4.89-4.89c.38-.38.38-1.02 0-1.4z"></path>
                                    </svg>
                                </div>
                            </div>
                            <AppNavbar/>
                        </aside>}
                </div>
            </div>
        </header>
    )
}

